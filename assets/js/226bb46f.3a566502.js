"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[1597],{4045(e,n,r){r.r(n),r.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>h,frontMatter:()=>l,metadata:()=>t,toc:()=>o});const t=JSON.parse('{"id":"module-2/chapter-4-actions","title":"Chapter 4: Actions","description":"Chapter Goal","source":"@site/docs/module-2/chapter-4-actions.md","sourceDirName":"module-2","slug":"/module-2/chapter-4-actions","permalink":"/Master-Robotics-AI/textbook/module-2/chapter-4-actions","draft":false,"unlisted":false,"editUrl":"https://github.com/HasnainCodeHub/Master-Robotics-AI/tree/main/docs/docs/module-2/chapter-4-actions.md","tags":[],"version":"current","sidebarPosition":5,"frontMatter":{"id":"chapter-4-actions","title":"Chapter 4: Actions","sidebar_label":"4. Actions","sidebar_position":5},"sidebar":"textbookSidebar","previous":{"title":"3. Services","permalink":"/Master-Robotics-AI/textbook/module-2/chapter-3-services"},"next":{"title":"5. URDF & Robot Description","permalink":"/Master-Robotics-AI/textbook/module-2/chapter-5-urdf-robot-description"}}');var s=r(4848),i=r(8453);const l={id:"chapter-4-actions",title:"Chapter 4: Actions",sidebar_label:"4. Actions",sidebar_position:5},a="Chapter 4: Actions for Long-Running Tasks",c={},o=[{value:"Chapter Goal",id:"chapter-goal",level:2},{value:"Learning Objectives",id:"learning-objectives",level:2},{value:"Why Actions Exist",id:"why-actions-exist",level:2},{value:"Action Anatomy",id:"action-anatomy",level:2},{value:"Action State Machine",id:"action-state-machine",level:3},{value:"Action Server Implementation",id:"action-server",level:2},{value:"Key Server Concepts",id:"key-server-concepts",level:3},{value:"Action Client Implementation",id:"action-client",level:2},{value:"Safe Cancellation",id:"cancellation",level:2},{value:"Physical Cancellation Requirements",id:"physical-cancellation-requirements",level:3},{value:"Cancel Implementation Pattern",id:"cancel-implementation-pattern",level:3},{value:"Custom Action Types",id:"custom-actions",level:2},{value:"Example: NavigateToPose.action",id:"example-navigatetoposeaction",level:3},{value:"Design Guidelines",id:"design-guidelines",level:3},{value:"Services vs Actions Decision",id:"decision-framework",level:2},{value:"Comparison Table",id:"comparison-table",level:3},{value:"Summary",id:"summary",level:2},{value:"Self-Assessment Questions",id:"self-assessment-questions",level:2},{value:"What&#39;s Next",id:"whats-next",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"chapter-4-actions-for-long-running-tasks",children:"Chapter 4: Actions for Long-Running Tasks"})}),"\n",(0,s.jsx)(n.h2,{id:"chapter-goal",children:"Chapter Goal"}),"\n",(0,s.jsxs)(n.p,{children:["By the end of this chapter, you will be able to ",(0,s.jsx)(n.strong,{children:"implement the action pattern for long-running tasks"})," with feedback and cancellation support\u2014essential for navigation, manipulation, and any task that takes significant time."]}),"\n",(0,s.jsx)(n.h2,{id:"learning-objectives",children:"Learning Objectives"}),"\n",(0,s.jsx)(n.p,{children:"After completing this chapter, you will be able to:"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"ID"}),(0,s.jsx)(n.th,{children:"Objective"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"4.1"}),(0,s.jsx)(n.td,{children:"Implement an action server that executes long-running tasks with progress feedback"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"4.2"}),(0,s.jsx)(n.td,{children:"Implement an action client that monitors progress and handles completion/failure/cancellation"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"4.3"}),(0,s.jsx)(n.td,{children:"Design action interfaces with appropriate goal, result, and feedback messages"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"4.4"}),(0,s.jsx)(n.td,{children:"Implement cancellation handling that safely stops physical operations"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"4.5"}),(0,s.jsx)(n.td,{children:"Choose between services and actions based on operation characteristics"})]})]})]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"why-actions-exist",children:"Why Actions Exist"}),"\n",(0,s.jsx)(n.p,{children:"Services work for quick operations (< 5 seconds), but robots often need to:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Navigate to a goal (30+ seconds)"}),"\n",(0,s.jsx)(n.li,{children:"Execute a manipulation sequence (10+ seconds)"}),"\n",(0,s.jsx)(n.li,{children:"Perform a scan or survey (minutes)"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"For these operations, you need:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Progress feedback"}),': "50% complete, 10 meters remaining"']}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Cancellation"}),': "Stop what you\'re doing"']}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Non-blocking execution"}),": Client continues while server executes"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Actions provide all three."})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"action-anatomy",children:"Action Anatomy"}),"\n",(0,s.jsx)(n.p,{children:"An action has three message types:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\r\n\u2502                        ACTION                             \u2502\r\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\r\n\u2502  GOAL (client \u2192 server)                                  \u2502\r\n\u2502    What the client wants done                            \u2502\r\n\u2502    Example: target_position, max_speed                   \u2502\r\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\r\n\u2502  FEEDBACK (server \u2192 client, periodic)                    \u2502\r\n\u2502    Progress updates during execution                     \u2502\r\n\u2502    Example: current_position, distance_remaining         \u2502\r\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\r\n\u2502  RESULT (server \u2192 client, once at end)                   \u2502\r\n\u2502    Final outcome when action completes                   \u2502\r\n\u2502    Example: final_position, total_time, success          \u2502\r\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,s.jsx)(n.h3,{id:"action-state-machine",children:"Action State Machine"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\r\n     \u2502 PENDING \u2502 Goal received, not yet accepted\r\n     \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518\r\n          \u2502 accept\r\n          \u25bc\r\n     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\r\n     \u2502 EXECUTING\u2502 Goal accepted, in progress\r\n     \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518\r\n          \u2502\r\n    \u250c\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\r\n    \u2502           \u2502             \u2502\r\n    \u25bc           \u25bc             \u25bc\r\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\r\n\u2502SUCCEEDED\u2502 \u2502 ABORTED\u2502   \u2502 CANCELED \u2502\r\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\r\n  Normal     Error        Client\r\n  completion occurred     requested\n"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"action-server",children:"Action Server Implementation"}),"\n",(0,s.jsx)(n.p,{children:"Let's implement a navigation action that moves to a target position."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:'#!/usr/bin/env python3\r\n"""\r\nNavigation Action Server\r\n\r\nExecutes navigation goals with progress feedback.\r\nPhysical grounding: Motion timing from M1 actuator characteristics.\r\n"""\r\n\r\nimport rclpy\r\nfrom rclpy.node import Node\r\nfrom rclpy.action import ActionServer, CancelResponse, GoalResponse\r\nfrom rclpy.callback_groups import ReentrantCallbackGroup\r\nfrom rclpy.executors import MultiThreadedExecutor\r\n\r\nfrom example_interfaces.action import Fibonacci  # We\'ll use this as template\r\nfrom geometry_msgs.msg import Point\r\n\r\nimport time\r\nimport math\r\n\r\n\r\nclass NavigationServer(Node):\r\n    """Action server for navigation goals."""\r\n\r\n    def __init__(self):\r\n        super().__init__(\'navigation_server\')\r\n\r\n        # Physical parameters from M1\r\n        self.max_velocity = 0.5  # m/s\r\n        self.position_tolerance = 0.1  # m\r\n        self.feedback_rate = 10.0  # Hz\r\n\r\n        # Current position (simulated)\r\n        self.current_x = 0.0\r\n        self.current_y = 0.0\r\n\r\n        # Use reentrant callback group for concurrent handling\r\n        self._action_server = ActionServer(\r\n            self,\r\n            Fibonacci,  # Using Fibonacci as placeholder\r\n            \'navigate_to_pose\',\r\n            execute_callback=self.execute_callback,\r\n            goal_callback=self.goal_callback,\r\n            cancel_callback=self.cancel_callback,\r\n            callback_group=ReentrantCallbackGroup()\r\n        )\r\n\r\n        self.get_logger().info(\'Navigation action server ready\')\r\n\r\n    def goal_callback(self, goal_request):\r\n        """Decide whether to accept or reject a goal."""\r\n        self.get_logger().info(\'Received navigation goal\')\r\n\r\n        # Could reject if robot is in error state, etc.\r\n        return GoalResponse.ACCEPT\r\n\r\n    def cancel_callback(self, goal_handle):\r\n        """Decide whether to accept cancellation request."""\r\n        self.get_logger().info(\'Received cancel request\')\r\n\r\n        # Always accept cancellation (safe stop is always possible)\r\n        return CancelResponse.ACCEPT\r\n\r\n    async def execute_callback(self, goal_handle):\r\n        """Execute the navigation goal."""\r\n        self.get_logger().info(\'Executing navigation goal\')\r\n\r\n        # Parse goal (using order as distance for this example)\r\n        target_distance = goal_handle.request.order\r\n        target_x = self.current_x + target_distance\r\n        target_y = self.current_y\r\n\r\n        # Calculate expected duration\r\n        distance = abs(target_distance)\r\n        expected_time = distance / self.max_velocity\r\n\r\n        self.get_logger().info(\r\n            f\'Navigating {distance:.1f}m, ETA: {expected_time:.1f}s\'\r\n        )\r\n\r\n        # Execute with feedback\r\n        feedback_msg = Fibonacci.Feedback()\r\n        start_time = time.time()\r\n\r\n        while True:\r\n            # Check for cancellation\r\n            if goal_handle.is_cancel_requested:\r\n                goal_handle.canceled()\r\n                self.get_logger().info(\'Navigation canceled\')\r\n\r\n                # Safe stop (would ramp down velocity in real system)\r\n                result = Fibonacci.Result()\r\n                result.sequence = [int(self.current_x * 100)]\r\n                return result\r\n\r\n            # Calculate progress\r\n            elapsed = time.time() - start_time\r\n            progress = min(elapsed / expected_time, 1.0)\r\n\r\n            # Update simulated position\r\n            self.current_x = progress * target_distance\r\n\r\n            # Check if goal reached\r\n            remaining = abs(target_x - self.current_x)\r\n            if remaining < self.position_tolerance:\r\n                break\r\n\r\n            # Publish feedback\r\n            feedback_msg.partial_sequence = [\r\n                int(progress * 100),  # Progress percentage\r\n                int(remaining * 100)  # Remaining distance (cm)\r\n            ]\r\n            goal_handle.publish_feedback(feedback_msg)\r\n\r\n            self.get_logger().info(\r\n                f\'Progress: {progress*100:.0f}%, remaining: {remaining:.2f}m\'\r\n            )\r\n\r\n            # Wait before next feedback\r\n            time.sleep(1.0 / self.feedback_rate)\r\n\r\n        # Success\r\n        goal_handle.succeed()\r\n        result = Fibonacci.Result()\r\n        result.sequence = [int(self.current_x * 100), int(self.current_y * 100)]\r\n\r\n        self.get_logger().info(\'Navigation succeeded\')\r\n        return result\r\n\r\n\r\ndef main(args=None):\r\n    rclpy.init(args=args)\r\n    node = NavigationServer()\r\n\r\n    # Use multi-threaded executor for concurrent operation\r\n    executor = MultiThreadedExecutor()\r\n    executor.add_node(node)\r\n\r\n    try:\r\n        executor.spin()\r\n    except KeyboardInterrupt:\r\n        pass\r\n    finally:\r\n        node.destroy_node()\r\n        rclpy.shutdown()\r\n\r\n\r\nif __name__ == \'__main__\':\r\n    main()\n'})}),"\n",(0,s.jsx)(n.h3,{id:"key-server-concepts",children:"Key Server Concepts"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Goal callback"}),": Decides whether to accept the goal. Reject if:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Robot is in error state"}),"\n",(0,s.jsx)(n.li,{children:"Goal is invalid"}),"\n",(0,s.jsx)(n.li,{children:"Another goal is already executing (if not supported)"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Cancel callback"}),": Decides whether to accept cancellation. Usually accept\u2014safe stop should always be possible."]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Execute callback"}),": The main execution loop. Must:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Check ",(0,s.jsx)(n.code,{children:"is_cancel_requested"})," frequently"]}),"\n",(0,s.jsx)(n.li,{children:"Publish feedback periodically"}),"\n",(0,s.jsxs)(n.li,{children:["Call ",(0,s.jsx)(n.code,{children:"succeed()"}),", ",(0,s.jsx)(n.code,{children:"abort()"}),", or ",(0,s.jsx)(n.code,{children:"canceled()"})," at the end"]}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"action-client",children:"Action Client Implementation"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:'#!/usr/bin/env python3\r\n"""\r\nNavigation Action Client\r\n\r\nSends navigation goals and monitors progress.\r\n"""\r\n\r\nimport rclpy\r\nfrom rclpy.node import Node\r\nfrom rclpy.action import ActionClient\r\nfrom example_interfaces.action import Fibonacci\r\n\r\n\r\nclass NavigationClient(Node):\r\n    """Action client for navigation goals."""\r\n\r\n    def __init__(self):\r\n        super().__init__(\'navigation_client\')\r\n\r\n        self._action_client = ActionClient(\r\n            self,\r\n            Fibonacci,\r\n            \'navigate_to_pose\'\r\n        )\r\n\r\n        self._goal_handle = None\r\n\r\n    def send_goal(self, distance: float):\r\n        """Send navigation goal and set up callbacks."""\r\n        self.get_logger().info(f\'Sending navigation goal: {distance}m\')\r\n\r\n        # Wait for server\r\n        if not self._action_client.wait_for_server(timeout_sec=10.0):\r\n            self.get_logger().error(\'Action server not available\')\r\n            return\r\n\r\n        # Create goal\r\n        goal_msg = Fibonacci.Goal()\r\n        goal_msg.order = int(distance)\r\n\r\n        # Send goal with callbacks\r\n        self._send_goal_future = self._action_client.send_goal_async(\r\n            goal_msg,\r\n            feedback_callback=self.feedback_callback\r\n        )\r\n        self._send_goal_future.add_done_callback(self.goal_response_callback)\r\n\r\n    def goal_response_callback(self, future):\r\n        """Called when server accepts/rejects the goal."""\r\n        self._goal_handle = future.result()\r\n\r\n        if not self._goal_handle.accepted:\r\n            self.get_logger().error(\'Goal rejected\')\r\n            return\r\n\r\n        self.get_logger().info(\'Goal accepted\')\r\n\r\n        # Set up result callback\r\n        self._get_result_future = self._goal_handle.get_result_async()\r\n        self._get_result_future.add_done_callback(self.result_callback)\r\n\r\n    def feedback_callback(self, feedback_msg):\r\n        """Called when feedback is received."""\r\n        feedback = feedback_msg.feedback.partial_sequence\r\n        if len(feedback) >= 2:\r\n            progress = feedback[0]\r\n            remaining_cm = feedback[1]\r\n            self.get_logger().info(\r\n                f\'Feedback: {progress}% complete, {remaining_cm}cm remaining\'\r\n            )\r\n\r\n    def result_callback(self, future):\r\n        """Called when action completes."""\r\n        result = future.result().result\r\n        status = future.result().status\r\n\r\n        if status == 4:  # SUCCEEDED\r\n            self.get_logger().info(f\'Navigation succeeded: {result.sequence}\')\r\n        elif status == 5:  # CANCELED\r\n            self.get_logger().info(\'Navigation was canceled\')\r\n        elif status == 6:  # ABORTED\r\n            self.get_logger().error(\'Navigation aborted\')\r\n\r\n    def cancel_goal(self):\r\n        """Cancel the current goal."""\r\n        if self._goal_handle is None:\r\n            return\r\n\r\n        self.get_logger().info(\'Canceling goal\')\r\n        cancel_future = self._goal_handle.cancel_goal_async()\r\n        cancel_future.add_done_callback(self.cancel_response_callback)\r\n\r\n    def cancel_response_callback(self, future):\r\n        """Called when cancel request is processed."""\r\n        cancel_response = future.result()\r\n        if len(cancel_response.goals_canceling) > 0:\r\n            self.get_logger().info(\'Goal cancel accepted\')\r\n        else:\r\n            self.get_logger().warn(\'Goal cancel rejected\')\r\n\r\n\r\ndef main(args=None):\r\n    rclpy.init(args=args)\r\n    client = NavigationClient()\r\n\r\n    # Send a goal\r\n    client.send_goal(5.0)  # Navigate 5 meters\r\n\r\n    # Spin to process callbacks\r\n    try:\r\n        rclpy.spin(client)\r\n    except KeyboardInterrupt:\r\n        client.cancel_goal()\r\n\r\n    client.destroy_node()\r\n    rclpy.shutdown()\r\n\r\n\r\nif __name__ == \'__main__\':\r\n    main()\n'})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"cancellation",children:"Safe Cancellation"}),"\n",(0,s.jsxs)(n.p,{children:["Cancellation in robotics must be ",(0,s.jsx)(n.strong,{children:"safe"}),"\u2014you can't instantly stop a moving robot."]}),"\n",(0,s.jsx)(n.h3,{id:"physical-cancellation-requirements",children:"Physical Cancellation Requirements"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"From M1 Actuator Knowledge"}),":"]}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"System"}),(0,s.jsx)(n.th,{children:"Stop Distance"}),(0,s.jsx)(n.th,{children:"Stop Time"}),(0,s.jsx)(n.th,{children:"Safe Cancel Behavior"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Mobile base at 1 m/s"}),(0,s.jsx)(n.td,{children:"0.5-1.0 m"}),(0,s.jsx)(n.td,{children:"0.5-1.0 s"}),(0,s.jsx)(n.td,{children:"Decelerate to stop"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Robot arm moving"}),(0,s.jsx)(n.td,{children:"0.1-0.2 m"}),(0,s.jsx)(n.td,{children:"0.2-0.5 s"}),(0,s.jsx)(n.td,{children:"Complete current segment or stop"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Gripper closing"}),(0,s.jsx)(n.td,{children:"N/A"}),(0,s.jsx)(n.td,{children:"Instant OK"}),(0,s.jsx)(n.td,{children:"Stop motor immediately"})]})]})]}),"\n",(0,s.jsx)(n.h3,{id:"cancel-implementation-pattern",children:"Cancel Implementation Pattern"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"async def execute_callback(self, goal_handle):\r\n    \"\"\"Execute with safe cancellation.\"\"\"\r\n\r\n    while not goal_reached:\r\n        # Check for cancellation\r\n        if goal_handle.is_cancel_requested:\r\n            # Safe stop sequence\r\n            self.get_logger().info('Initiating safe stop')\r\n\r\n            # 1. Command deceleration\r\n            self.command_velocity(0.0)\r\n\r\n            # 2. Wait for robot to stop (physical time)\r\n            decel_time = self.current_velocity / self.max_deceleration\r\n            await asyncio.sleep(decel_time)\r\n\r\n            # 3. Confirm stopped\r\n            if self.current_velocity < 0.01:\r\n                goal_handle.canceled()\r\n                return self.create_result(success=False, reason='canceled')\r\n            else:\r\n                goal_handle.abort()\r\n                return self.create_result(success=False, reason='stop_failed')\r\n\r\n        # Normal execution...\n"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"custom-actions",children:"Custom Action Types"}),"\n",(0,s.jsx)(n.p,{children:"Define action interfaces for your specific operations."}),"\n",(0,s.jsx)(n.h3,{id:"example-navigatetoposeaction",children:"Example: NavigateToPose.action"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"# Goal\r\ngeometry_msgs/PoseStamped target_pose\r\nfloat32 max_velocity\r\nbool allow_backward\r\n---\r\n# Result\r\nbool success\r\nstring message\r\ngeometry_msgs/PoseStamped final_pose\r\nfloat32 total_distance\r\nfloat32 total_time\r\n---\r\n# Feedback\r\ngeometry_msgs/PoseStamped current_pose\r\nfloat32 distance_remaining\r\nfloat32 estimated_time_remaining\r\nfloat32 current_velocity\n"})}),"\n",(0,s.jsx)(n.h3,{id:"design-guidelines",children:"Design Guidelines"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Goal"}),": What the client wants"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Include all parameters needed to execute"}),"\n",(0,s.jsx)(n.li,{children:"Include constraints (max velocity, allowed deviation)"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Feedback"}),": Progress updates"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Include current state"}),"\n",(0,s.jsx)(n.li,{children:"Include estimates (time remaining, distance remaining)"}),"\n",(0,s.jsx)(n.li,{children:"Keep small (sent frequently)"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Result"}),": Final outcome"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Include success/failure status"}),"\n",(0,s.jsx)(n.li,{children:"Include final measurements"}),"\n",(0,s.jsx)(n.li,{children:"Include error information if failed"}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"decision-framework",children:"Services vs Actions Decision"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"Does operation take more than ~5 seconds?\r\n\u251c\u2500\u2500 No \u2192 Use SERVICE\r\n\u2514\u2500\u2500 Yes \u2192 Does client need progress updates?\r\n    \u251c\u2500\u2500 No \u2192 Could still use ACTION (for cancellation)\r\n    \u2514\u2500\u2500 Yes \u2192 Use ACTION\r\n\r\nCan operation be safely interrupted?\r\n\u251c\u2500\u2500 No \u2192 Use SERVICE (must complete)\r\n\u2514\u2500\u2500 Yes \u2192 Use ACTION (supports cancellation)\n"})}),"\n",(0,s.jsx)(n.h3,{id:"comparison-table",children:"Comparison Table"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Aspect"}),(0,s.jsx)(n.th,{children:"Service"}),(0,s.jsx)(n.th,{children:"Action"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Duration"}),(0,s.jsx)(n.td,{children:"Short (<5s)"}),(0,s.jsx)(n.td,{children:"Any length"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Progress"}),(0,s.jsx)(n.td,{children:"No feedback"}),(0,s.jsx)(n.td,{children:"Continuous feedback"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Cancellation"}),(0,s.jsx)(n.td,{children:"Not supported"}),(0,s.jsx)(n.td,{children:"Supported"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Complexity"}),(0,s.jsx)(n.td,{children:"Simple"}),(0,s.jsx)(n.td,{children:"More complex"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Use case"}),(0,s.jsx)(n.td,{children:"Config, queries"}),(0,s.jsx)(n.td,{children:"Navigation, manipulation"})]})]})]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,s.jsx)(n.p,{children:"This chapter covered actions for long-running robot operations:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Actions"})," provide goal/feedback/result communication for operations that take significant time."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Action servers"})," execute goals asynchronously, publishing periodic feedback and handling cancellation."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Action clients"})," send goals, receive feedback callbacks, and can request cancellation."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Safe cancellation"})," must respect physical constraints\u2014robots can't stop instantly."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Services vs Actions"}),": short/no-feedback \u2192 service; long/feedback-needed \u2192 action."]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"self-assessment-questions",children:"Self-Assessment Questions"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Action Design"}),": Design an action interface for a pick-and-place operation. What goal, feedback, and result fields would you include?"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Cancellation Safety"}),": A robot arm is moving at 1 m/s when cancel is requested. If maximum deceleration is 2 m/s\xb2, how long must the cancel handler wait before reporting completion?"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Feedback Rate"}),": Navigation feedback is published at 10 Hz. The client displays progress on a screen refreshing at 30 Hz. Is there a problem? What about if feedback is at 1 Hz?"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"State Handling"}),": Your action server receives a new goal while executing a previous goal. What are your options, and which is safest?"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Pattern Selection"}),": A robot performs a 3-second homing sequence that cannot be interrupted once started. Service or action? Why?"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"whats-next",children:"What's Next"}),"\n",(0,s.jsxs)(n.p,{children:["In ",(0,s.jsx)(n.a,{href:"/module-2/chapter-5-urdf-robot-description",children:"Chapter 5: URDF and Robot Description"}),", you'll learn to describe robot structure and sensor placement using URDF, connecting to the physical robot models from Module 1."]})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},8453(e,n,r){r.d(n,{R:()=>l,x:()=>a});var t=r(6540);const s={},i=t.createContext(s);function l(e){const n=t.useContext(i);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:l(e.components),t.createElement(i.Provider,{value:n},e.children)}}}]);