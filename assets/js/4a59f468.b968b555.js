"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[6948],{6724(e,n,r){r.r(n),r.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>h,frontMatter:()=>o,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"module-3/chapter-5-unity-integration","title":"Chapter 5: Unity Integration","description":"Chapter Goal","source":"@site/docs/module-3/chapter-5-unity-integration.md","sourceDirName":"module-3","slug":"/module-3/chapter-5-unity-integration","permalink":"/Master-Robotics-AI/textbook/module-3/chapter-5-unity-integration","draft":false,"unlisted":false,"editUrl":"https://github.com/HasnainCodeHub/Master-Robotics-AI/tree/main/docs/docs/module-3/chapter-5-unity-integration.md","tags":[],"version":"current","sidebarPosition":6,"frontMatter":{"id":"chapter-5-unity-integration","title":"Chapter 5: Unity Integration","sidebar_label":"5. Unity Integration","sidebar_position":6},"sidebar":"textbookSidebar","previous":{"title":"4. Simulated Actuators","permalink":"/Master-Robotics-AI/textbook/module-3/chapter-4-simulated-actuators"},"next":{"title":"6. Reality Gap","permalink":"/Master-Robotics-AI/textbook/module-3/chapter-6-reality-gap"}}');var t=r(4848),s=r(8453);const o={id:"chapter-5-unity-integration",title:"Chapter 5: Unity Integration",sidebar_label:"5. Unity Integration",sidebar_position:6},a="Chapter 5: Unity and ROS 2 Integration",l={},c=[{value:"Chapter Goal",id:"chapter-goal",level:2},{value:"Learning Objectives",id:"learning-objectives",level:2},{value:"Why Unity for Robotics?",id:"why-unity-for-robotics",level:2},{value:"Unity Robotics Hub",id:"unity-robotics",level:2},{value:"Installation",id:"installation",level:3},{value:"Project Configuration",id:"project-configuration",level:3},{value:"URDF Import",id:"urdf-import",level:2},{value:"Import Process",id:"import-process",level:3},{value:"Import Settings",id:"import-settings",level:3},{value:"Articulation Bodies",id:"articulation-bodies",level:3},{value:"ROS-TCP-Connector",id:"ros-tcp",level:2},{value:"Architecture",id:"architecture",level:3},{value:"ROS 2 Endpoint Setup",id:"ros-2-endpoint-setup",level:3},{value:"Unity Configuration",id:"unity-configuration",level:3},{value:"Testing Connection",id:"testing-connection",level:3},{value:"Camera Simulation",id:"camera",level:2},{value:"Camera Publisher Script",id:"camera-publisher-script",level:3},{value:"High-Quality Rendering (HDRP)",id:"high-quality-rendering-hdrp",level:3},{value:"LiDAR Simulation",id:"lidar",level:2},{value:"Raycasting LiDAR",id:"raycasting-lidar",level:3},{value:"Robot Control",id:"control",level:2},{value:"Velocity Command Subscriber",id:"velocity-command-subscriber",level:3},{value:"Odometry Publisher",id:"odometry-publisher",level:3},{value:"Decision Framework: Unity vs Gazebo",id:"decision",level:2},{value:"When to Use Unity",id:"when-to-use-unity",level:3},{value:"When to Use Gazebo",id:"when-to-use-gazebo",level:3},{value:"Decision Flowchart",id:"decision-flowchart",level:3},{value:"Physical Grounding Considerations",id:"physical",level:2},{value:"Timing Differences",id:"timing-differences",level:3},{value:"Physics Differences",id:"physics-differences",level:3},{value:"Summary",id:"summary",level:2},{value:"Self-Assessment Questions",id:"self-assessment-questions",level:2},{value:"What&#39;s Next",id:"whats-next",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,s.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"chapter-5-unity-and-ros-2-integration",children:"Chapter 5: Unity and ROS 2 Integration"})}),"\n",(0,t.jsx)(n.h2,{id:"chapter-goal",children:"Chapter Goal"}),"\n",(0,t.jsxs)(n.p,{children:["By the end of this chapter, you will be able to ",(0,t.jsx)(n.strong,{children:"use Unity as an alternative simulation environment with ROS 2 integration"}),", understanding its strengths for visualization and when to choose it over Gazebo."]}),"\n",(0,t.jsx)(n.h2,{id:"learning-objectives",children:"Learning Objectives"}),"\n",(0,t.jsx)(n.p,{children:"After completing this chapter, you will be able to:"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"ID"}),(0,t.jsx)(n.th,{children:"Objective"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"5.1"}),(0,t.jsx)(n.td,{children:"Install and configure Unity with Robotics packages"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"5.2"}),(0,t.jsx)(n.td,{children:"Import a URDF robot into Unity and configure articulation physics"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"5.3"}),(0,t.jsx)(n.td,{children:"Configure Unity cameras publishing to ROS 2 Image topics"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"5.4"}),(0,t.jsx)(n.td,{children:"Configure Unity sensor simulation with ROS 2 publishing"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"5.5"}),(0,t.jsx)(n.td,{children:"Implement bidirectional control: ROS 2 commands driving Unity robots"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"5.6"}),(0,t.jsx)(n.td,{children:"Articulate when to choose Unity vs Gazebo for simulation"})]})]})]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"why-unity-for-robotics",children:"Why Unity for Robotics?"}),"\n",(0,t.jsx)(n.p,{children:"Unity offers capabilities that Gazebo doesn't:"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Capability"}),(0,t.jsx)(n.th,{children:"Unity"}),(0,t.jsx)(n.th,{children:"Gazebo"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Visual fidelity"}),(0,t.jsx)(n.td,{children:"Photorealistic (HDRP)"}),(0,t.jsx)(n.td,{children:"Functional"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Asset ecosystem"}),(0,t.jsx)(n.td,{children:"Extensive marketplace"}),(0,t.jsx)(n.td,{children:"Limited"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Ray tracing"}),(0,t.jsx)(n.td,{children:"RTX support"}),(0,t.jsx)(n.td,{children:"Not available"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"VR/AR integration"}),(0,t.jsx)(n.td,{children:"Native"}),(0,t.jsx)(n.td,{children:"Limited"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Cross-platform"}),(0,t.jsx)(n.td,{children:"Yes"}),(0,t.jsx)(n.td,{children:"Linux-focused"})]})]})]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Use Unity when"}),": Perception training data, demonstrations, visualization-intensive scenarios."]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Use Gazebo when"}),": Physics accuracy, control algorithm validation, headless batch testing."]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"unity-robotics",children:"Unity Robotics Hub"}),"\n",(0,t.jsx)(n.p,{children:"Unity's robotics tools consist of several packages:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"Unity Robotics\r\n\u251c\u2500\u2500 URDF Importer          \u2192 Import robot descriptions\r\n\u251c\u2500\u2500 ROS-TCP-Connector      \u2192 ROS 2 communication bridge\r\n\u251c\u2500\u2500 Perception Package     \u2192 Synthetic data generation\r\n\u2514\u2500\u2500 Articulation Bodies    \u2192 Robot physics simulation\n"})}),"\n",(0,t.jsx)(n.h3,{id:"installation",children:"Installation"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Install Unity Hub"})," from unity.com"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Install Unity Editor"})," (2021.3 LTS or newer)"]}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.strong,{children:"Create new 3D project"})}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Add packages via Package Manager"}),":"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"Window \u2192 Package Manager \u2192 + \u2192 Add package from git URL\r\n\r\nhttps://github.com/Unity-Technologies/ROS-TCP-Connector.git?path=/com.unity.robotics.ros-tcp-connector\r\nhttps://github.com/Unity-Technologies/URDF-Importer.git?path=/com.unity.robotics.urdf-importer\n"})}),"\n",(0,t.jsx)(n.h3,{id:"project-configuration",children:"Project Configuration"}),"\n",(0,t.jsx)(n.p,{children:"Enable the new input system and linear color space:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"Edit \u2192 Project Settings \u2192 Player\r\n  - Other Settings \u2192 Color Space: Linear\r\n  - Other Settings \u2192 Active Input Handling: Both\n"})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"urdf-import",children:"URDF Import"}),"\n",(0,t.jsx)(n.h3,{id:"import-process",children:"Import Process"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Place URDF files"})," in ",(0,t.jsx)(n.code,{children:"Assets/URDFs/"})," folder"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Include meshes"})," in relative paths"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Right-click URDF"})," \u2192 Import Robot from URDF"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"import-settings",children:"Import Settings"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"URDF Import Settings:\r\n\u251c\u2500\u2500 Axis Type: Z-Up (match ROS convention)\r\n\u251c\u2500\u2500 Mesh Decomposer: VHACD (for concave meshes)\r\n\u251c\u2500\u2500 Create Collision: True\r\n\u251c\u2500\u2500 Use Inertia from URDF: True\r\n\u2514\u2500\u2500 Rigidbody \u2192 Articulation Body: True\n"})}),"\n",(0,t.jsx)(n.h3,{id:"articulation-bodies",children:"Articulation Bodies"}),"\n",(0,t.jsxs)(n.p,{children:["Unity uses ",(0,t.jsx)(n.strong,{children:"Articulation Bodies"})," for robots\u2014more stable than regular rigidbodies for kinematic chains."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-csharp",children:"// Articulation body properties\r\nArticulationBody body = GetComponent<ArticulationBody>();\r\n\r\n// Set joint type\r\nbody.jointType = ArticulationJointType.RevoluteJoint;\r\n\r\n// Set limits\r\nArticulationDrive drive = body.xDrive;\r\ndrive.lowerLimit = -90f;  // degrees\r\ndrive.upperLimit = 90f;\r\ndrive.stiffness = 10000f;\r\ndrive.damping = 100f;\r\nbody.xDrive = drive;\n"})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"ros-tcp",children:"ROS-TCP-Connector"}),"\n",(0,t.jsx)(n.h3,{id:"architecture",children:"Architecture"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         TCP/IP          \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\r\n\u2502                 \u2502 \u25c4\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba \u2502                 \u2502\r\n\u2502  Unity Editor   \u2502      Port 10000         \u2502  ROS 2 System   \u2502\r\n\u2502                 \u2502                         \u2502                 \u2502\r\n\u2502  - Publishers   \u2502                         \u2502  - Subscribers  \u2502\r\n\u2502  - Subscribers  \u2502                         \u2502  - Publishers   \u2502\r\n\u2502  - Services     \u2502                         \u2502  - Services     \u2502\r\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                         \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\r\n        \u2502                                           \u2502\r\n        \u25bc                                           \u25bc\r\n   ROSConnection                            ros_tcp_endpoint\r\n   (Unity C#)                               (ROS 2 node)\n"})}),"\n",(0,t.jsx)(n.h3,{id:"ros-2-endpoint-setup",children:"ROS 2 Endpoint Setup"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# Install ros_tcp_endpoint\r\ncd ~/ros2_ws/src\r\ngit clone https://github.com/Unity-Technologies/ROS-TCP-Endpoint.git -b ROS2v0.7.0\r\ncd ..\r\ncolcon build\r\n\r\n# Run the endpoint\r\nros2 run ros_tcp_endpoint default_server_endpoint --ros-args -p ROS_IP:=127.0.0.1\n"})}),"\n",(0,t.jsx)(n.h3,{id:"unity-configuration",children:"Unity Configuration"}),"\n",(0,t.jsx)(n.p,{children:"In Unity, add ROS Connection:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"Robotics \u2192 ROS Settings\r\n  - ROS IP Address: 127.0.0.1\r\n  - ROS Port: 10000\r\n  - Connect on Start: True\r\n  - Protocol: ROS2\n"})}),"\n",(0,t.jsx)(n.h3,{id:"testing-connection",children:"Testing Connection"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# Terminal 1: Run ROS endpoint\r\nros2 run ros_tcp_endpoint default_server_endpoint\r\n\r\n# Terminal 2: Check topics\r\nros2 topic list\r\n\r\n# In Unity: Press Play\r\n# Should see connection established\n"})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"camera",children:"Camera Simulation"}),"\n",(0,t.jsx)(n.h3,{id:"camera-publisher-script",children:"Camera Publisher Script"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-csharp",children:'using UnityEngine;\r\nusing Unity.Robotics.ROSTCPConnector;\r\nusing RosMessageTypes.Sensor;\r\nusing RosMessageTypes.Std;\r\n\r\npublic class CameraPublisher : MonoBehaviour\r\n{\r\n    public Camera robotCamera;\r\n    public string topicName = "/camera/image_raw";\r\n    public float publishRate = 30f;\r\n\r\n    private ROSConnection ros;\r\n    private RenderTexture renderTexture;\r\n    private Texture2D texture2D;\r\n    private float lastPublishTime;\r\n\r\n    void Start()\r\n    {\r\n        ros = ROSConnection.GetOrCreateInstance();\r\n        ros.RegisterPublisher<ImageMsg>(topicName);\r\n\r\n        // Create render texture matching camera resolution\r\n        renderTexture = new RenderTexture(640, 480, 24);\r\n        robotCamera.targetTexture = renderTexture;\r\n\r\n        texture2D = new Texture2D(640, 480, TextureFormat.RGB24, false);\r\n    }\r\n\r\n    void Update()\r\n    {\r\n        if (Time.time - lastPublishTime < 1f / publishRate)\r\n            return;\r\n\r\n        lastPublishTime = Time.time;\r\n        PublishImage();\r\n    }\r\n\r\n    void PublishImage()\r\n    {\r\n        // Capture camera view\r\n        RenderTexture.active = renderTexture;\r\n        texture2D.ReadPixels(new Rect(0, 0, 640, 480), 0, 0);\r\n        texture2D.Apply();\r\n        RenderTexture.active = null;\r\n\r\n        // Create ROS message\r\n        byte[] imageData = texture2D.GetRawTextureData();\r\n\r\n        ImageMsg msg = new ImageMsg\r\n        {\r\n            header = new HeaderMsg\r\n            {\r\n                stamp = new RosMessageTypes.BuiltinInterfaces.TimeMsg\r\n                {\r\n                    sec = (int)Time.time,\r\n                    nanosec = (uint)((Time.time % 1) * 1e9)\r\n                },\r\n                frame_id = "camera_link"\r\n            },\r\n            height = 480,\r\n            width = 640,\r\n            encoding = "rgb8",\r\n            is_bigendian = 0,\r\n            step = 640 * 3,\r\n            data = imageData\r\n        };\r\n\r\n        ros.Publish(topicName, msg);\r\n    }\r\n}\n'})}),"\n",(0,t.jsx)(n.h3,{id:"high-quality-rendering-hdrp",children:"High-Quality Rendering (HDRP)"}),"\n",(0,t.jsx)(n.p,{children:"For photorealistic images:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Install HDRP"})," via Package Manager"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Convert project"})," to HDRP"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Configure camera"})," for HDRP settings"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-csharp",children:"// HDRP camera settings for realistic rendering\r\nHDAdditionalCameraData hdCamera = camera.GetComponent<HDAdditionalCameraData>();\r\nhdCamera.antialiasing = HDAdditionalCameraData.AntialiasingMode.TemporalAntialiasing;\n"})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"lidar",children:"LiDAR Simulation"}),"\n",(0,t.jsx)(n.h3,{id:"raycasting-lidar",children:"Raycasting LiDAR"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-csharp",children:'using UnityEngine;\r\nusing Unity.Robotics.ROSTCPConnector;\r\nusing RosMessageTypes.Sensor;\r\n\r\npublic class LidarPublisher : MonoBehaviour\r\n{\r\n    public string topicName = "/scan";\r\n    public float publishRate = 10f;\r\n\r\n    [Header("LiDAR Parameters")]\r\n    public float minAngle = -3.14159f;\r\n    public float maxAngle = 3.14159f;\r\n    public int numRays = 360;\r\n    public float minRange = 0.1f;\r\n    public float maxRange = 30f;\r\n\r\n    private ROSConnection ros;\r\n    private float lastPublishTime;\r\n\r\n    void Start()\r\n    {\r\n        ros = ROSConnection.GetOrCreateInstance();\r\n        ros.RegisterPublisher<LaserScanMsg>(topicName);\r\n    }\r\n\r\n    void Update()\r\n    {\r\n        if (Time.time - lastPublishTime < 1f / publishRate)\r\n            return;\r\n\r\n        lastPublishTime = Time.time;\r\n        PublishScan();\r\n    }\r\n\r\n    void PublishScan()\r\n    {\r\n        float[] ranges = new float[numRays];\r\n        float angleIncrement = (maxAngle - minAngle) / numRays;\r\n\r\n        for (int i = 0; i < numRays; i++)\r\n        {\r\n            float angle = minAngle + i * angleIncrement;\r\n            Vector3 direction = Quaternion.Euler(0, angle * Mathf.Rad2Deg, 0) * transform.forward;\r\n\r\n            RaycastHit hit;\r\n            if (Physics.Raycast(transform.position, direction, out hit, maxRange))\r\n            {\r\n                ranges[i] = hit.distance;\r\n            }\r\n            else\r\n            {\r\n                ranges[i] = maxRange;  // No hit\r\n            }\r\n        }\r\n\r\n        LaserScanMsg msg = new LaserScanMsg\r\n        {\r\n            header = new RosMessageTypes.Std.HeaderMsg\r\n            {\r\n                stamp = new RosMessageTypes.BuiltinInterfaces.TimeMsg\r\n                {\r\n                    sec = (int)Time.time,\r\n                    nanosec = (uint)((Time.time % 1) * 1e9)\r\n                },\r\n                frame_id = "lidar_link"\r\n            },\r\n            angle_min = minAngle,\r\n            angle_max = maxAngle,\r\n            angle_increment = angleIncrement,\r\n            time_increment = 0f,\r\n            scan_time = 1f / publishRate,\r\n            range_min = minRange,\r\n            range_max = maxRange,\r\n            ranges = ranges,\r\n            intensities = new float[0]\r\n        };\r\n\r\n        ros.Publish(topicName, msg);\r\n    }\r\n}\n'})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"control",children:"Robot Control"}),"\n",(0,t.jsx)(n.h3,{id:"velocity-command-subscriber",children:"Velocity Command Subscriber"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-csharp",children:'using UnityEngine;\r\nusing Unity.Robotics.ROSTCPConnector;\r\nusing RosMessageTypes.Geometry;\r\n\r\npublic class DiffDriveController : MonoBehaviour\r\n{\r\n    public string cmdVelTopic = "/cmd_vel";\r\n    public ArticulationBody leftWheel;\r\n    public ArticulationBody rightWheel;\r\n\r\n    public float wheelRadius = 0.1f;\r\n    public float wheelSeparation = 0.5f;\r\n\r\n    private Vector3 targetVelocity = Vector3.zero;\r\n\r\n    void Start()\r\n    {\r\n        ROSConnection.GetOrCreateInstance().Subscribe<TwistMsg>(\r\n            cmdVelTopic, OnCmdVelReceived);\r\n    }\r\n\r\n    void OnCmdVelReceived(TwistMsg msg)\r\n    {\r\n        // Convert Twist to wheel velocities\r\n        float linear = (float)msg.linear.x;\r\n        float angular = (float)msg.angular.z;\r\n\r\n        float leftVel = (linear - angular * wheelSeparation / 2) / wheelRadius;\r\n        float rightVel = (linear + angular * wheelSeparation / 2) / wheelRadius;\r\n\r\n        // Apply to articulation bodies\r\n        SetWheelVelocity(leftWheel, leftVel);\r\n        SetWheelVelocity(rightWheel, rightVel);\r\n    }\r\n\r\n    void SetWheelVelocity(ArticulationBody wheel, float velocity)\r\n    {\r\n        ArticulationDrive drive = wheel.xDrive;\r\n        drive.targetVelocity = velocity * Mathf.Rad2Deg;  // Unity uses degrees\r\n        wheel.xDrive = drive;\r\n    }\r\n}\n'})}),"\n",(0,t.jsx)(n.h3,{id:"odometry-publisher",children:"Odometry Publisher"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-csharp",children:'using UnityEngine;\r\nusing Unity.Robotics.ROSTCPConnector;\r\nusing RosMessageTypes.Nav;\r\nusing RosMessageTypes.Geometry;\r\n\r\npublic class OdometryPublisher : MonoBehaviour\r\n{\r\n    public string topicName = "/odom";\r\n    public float publishRate = 50f;\r\n\r\n    private ROSConnection ros;\r\n    private Vector3 lastPosition;\r\n    private Quaternion lastRotation;\r\n    private float lastPublishTime;\r\n\r\n    void Start()\r\n    {\r\n        ros = ROSConnection.GetOrCreateInstance();\r\n        ros.RegisterPublisher<OdometryMsg>(topicName);\r\n\r\n        lastPosition = transform.position;\r\n        lastRotation = transform.rotation;\r\n    }\r\n\r\n    void Update()\r\n    {\r\n        if (Time.time - lastPublishTime < 1f / publishRate)\r\n            return;\r\n\r\n        lastPublishTime = Time.time;\r\n        PublishOdometry();\r\n    }\r\n\r\n    void PublishOdometry()\r\n    {\r\n        OdometryMsg msg = new OdometryMsg\r\n        {\r\n            header = new RosMessageTypes.Std.HeaderMsg\r\n            {\r\n                stamp = new RosMessageTypes.BuiltinInterfaces.TimeMsg\r\n                {\r\n                    sec = (int)Time.time,\r\n                    nanosec = (uint)((Time.time % 1) * 1e9)\r\n                },\r\n                frame_id = "odom"\r\n            },\r\n            child_frame_id = "base_link",\r\n            pose = new PoseWithCovarianceMsg\r\n            {\r\n                pose = new PoseMsg\r\n                {\r\n                    position = new PointMsg\r\n                    {\r\n                        x = transform.position.z,  // ROS X = Unity Z\r\n                        y = -transform.position.x, // ROS Y = -Unity X\r\n                        z = transform.position.y   // ROS Z = Unity Y\r\n                    },\r\n                    orientation = new QuaternionMsg\r\n                    {\r\n                        // Convert Unity to ROS quaternion\r\n                        x = transform.rotation.z,\r\n                        y = -transform.rotation.x,\r\n                        z = transform.rotation.y,\r\n                        w = -transform.rotation.w\r\n                    }\r\n                }\r\n            }\r\n        };\r\n\r\n        ros.Publish(topicName, msg);\r\n    }\r\n}\n'})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"decision",children:"Decision Framework: Unity vs Gazebo"}),"\n",(0,t.jsx)(n.h3,{id:"when-to-use-unity",children:"When to Use Unity"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Scenario"}),(0,t.jsx)(n.th,{children:"Why Unity"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Training perception models"}),(0,t.jsx)(n.td,{children:"Photorealistic images, domain randomization"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Customer demonstrations"}),(0,t.jsx)(n.td,{children:"High visual quality"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"VR/AR applications"}),(0,t.jsx)(n.td,{children:"Native support"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Complex visual environments"}),(0,t.jsx)(n.td,{children:"Asset store availability"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Cross-platform deployment"}),(0,t.jsx)(n.td,{children:"Windows/Mac/Linux/Web"})]})]})]}),"\n",(0,t.jsx)(n.h3,{id:"when-to-use-gazebo",children:"When to Use Gazebo"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Scenario"}),(0,t.jsx)(n.th,{children:"Why Gazebo"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Control algorithm development"}),(0,t.jsx)(n.td,{children:"Better physics accuracy"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Contact-rich manipulation"}),(0,t.jsx)(n.td,{children:"More accurate contact dynamics"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Headless batch testing"}),(0,t.jsx)(n.td,{children:"Native headless mode"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"ROS 2 integration"}),(0,t.jsx)(n.td,{children:"Tighter integration, less latency"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Open-source requirement"}),(0,t.jsx)(n.td,{children:"Fully open source"})]})]})]}),"\n",(0,t.jsx)(n.h3,{id:"decision-flowchart",children:"Decision Flowchart"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"Primary goal?\r\n\u251c\u2500\u2500 Perception/Vision \u2192 Unity (better rendering)\r\n\u251c\u2500\u2500 Control/Dynamics \u2192 Gazebo (better physics)\r\n\u251c\u2500\u2500 Navigation \u2192 Either (similar capability)\r\n\u2514\u2500\u2500 Manipulation \u2192 Gazebo (contact physics)\r\n\r\nNeed photorealistic images?\r\n\u251c\u2500\u2500 Yes \u2192 Unity\r\n\u2514\u2500\u2500 No \u2192 Gazebo (faster)\r\n\r\nRunning batch tests?\r\n\u251c\u2500\u2500 Yes \u2192 Gazebo (headless support)\r\n\u2514\u2500\u2500 No \u2192 Either\r\n\r\nTeam expertise?\r\n\u251c\u2500\u2500 Game development \u2192 Unity\r\n\u251c\u2500\u2500 ROS ecosystem \u2192 Gazebo\r\n\u2514\u2500\u2500 Both \u2192 Choose by task\n"})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"physical",children:"Physical Grounding Considerations"}),"\n",(0,t.jsx)(n.h3,{id:"timing-differences",children:"Timing Differences"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Aspect"}),(0,t.jsx)(n.th,{children:"Gazebo"}),(0,t.jsx)(n.th,{children:"Unity"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"ROS bridge"}),(0,t.jsx)(n.td,{children:"ros_gz (shared memory)"}),(0,t.jsx)(n.td,{children:"TCP (network)"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Typical latency"}),(0,t.jsx)(n.td,{children:"1-5 ms"}),(0,t.jsx)(n.td,{children:"5-20 ms"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Determinism"}),(0,t.jsx)(n.td,{children:"High"}),(0,t.jsx)(n.td,{children:"Moderate"})]})]})]}),"\n",(0,t.jsx)(n.p,{children:"The TCP bridge adds latency that doesn't exist in ros_gz. Account for this in timing-sensitive applications."}),"\n",(0,t.jsx)(n.h3,{id:"physics-differences",children:"Physics Differences"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Aspect"}),(0,t.jsx)(n.th,{children:"Gazebo"}),(0,t.jsx)(n.th,{children:"Unity"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Physics engine"}),(0,t.jsx)(n.td,{children:"ODE/Bullet/DART"}),(0,t.jsx)(n.td,{children:"PhysX"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Contact accuracy"}),(0,t.jsx)(n.td,{children:"Higher"}),(0,t.jsx)(n.td,{children:"Moderate"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Articulation"}),(0,t.jsx)(n.td,{children:"ros2_control"}),(0,t.jsx)(n.td,{children:"ArticulationBody"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Friction model"}),(0,t.jsx)(n.td,{children:"Configurable"}),(0,t.jsx)(n.td,{children:"PhysX default"})]})]})]}),"\n",(0,t.jsx)(n.p,{children:"Control gains tuned in Unity may not transfer directly to Gazebo or real hardware."}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,t.jsx)(n.p,{children:"This chapter covered Unity as an alternative simulation platform:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Unity Robotics Hub"})," provides URDF import and ROS integration."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"ROS-TCP-Connector"})," bridges Unity and ROS 2 over TCP."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Camera simulation"})," leverages Unity's rendering for photorealistic images."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"LiDAR simulation"})," uses raycasting similar to Gazebo."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Robot control"})," receives commands from ROS 2 and publishes odometry."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Decision framework"}),": Use Unity for visual fidelity, Gazebo for physics accuracy."]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"self-assessment-questions",children:"Self-Assessment Questions"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Platform Selection"}),": You need to train a neural network for object detection. Would you use Unity or Gazebo? Why?"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Latency Impact"}),": Your control loop runs at 100 Hz. The Unity TCP bridge adds 15ms latency. What is the maximum achievable control rate?"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"URDF Import"}),": Your imported robot falls through the floor. What physics component should you check?"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Camera Publishing"}),": Your ROS 2 node receives camera images but they appear upside-down. Where is the coordinate transform issue?"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Use Case"}),": You need to demonstrate a robot to investors with high visual quality, but also need to test the navigation algorithm accurately. What would you recommend?"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"whats-next",children:"What's Next"}),"\n",(0,t.jsxs)(n.p,{children:["In ",(0,t.jsx)(n.a,{href:"/module-3/chapter-6-reality-gap",children:"Chapter 6: Reality Gap"}),", you'll critically examine the differences between simulation and reality\u2014understanding what transfers and what doesn't, preparing you for Module 4's sim-to-real techniques."]})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},8453(e,n,r){r.d(n,{R:()=>o,x:()=>a});var i=r(6540);const t={},s=i.createContext(t);function o(e){const n=i.useContext(s);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),i.createElement(s.Provider,{value:n},e.children)}}}]);