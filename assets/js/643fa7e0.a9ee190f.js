"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[4841],{3688(e,n,r){r.r(n),r.d(n,{assets:()=>l,contentTitle:()=>s,default:()=>p,frontMatter:()=>o,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"module-2/chapter-6-integration-patterns","title":"Chapter 6: Integration Patterns","description":"Chapter Goal","source":"@site/docs/module-2/chapter-6-integration-patterns.md","sourceDirName":"module-2","slug":"/module-2/chapter-6-integration-patterns","permalink":"/Master-Robotics-AI/textbook/module-2/chapter-6-integration-patterns","draft":false,"unlisted":false,"editUrl":"https://github.com/HasnainCodeHub/Master-Robotics-AI/tree/main/docs/docs/module-2/chapter-6-integration-patterns.md","tags":[],"version":"current","sidebarPosition":7,"frontMatter":{"id":"chapter-6-integration-patterns","title":"Chapter 6: Integration Patterns","sidebar_label":"6. Integration Patterns","sidebar_position":7},"sidebar":"textbookSidebar","previous":{"title":"5. URDF & Robot Description","permalink":"/Master-Robotics-AI/textbook/module-2/chapter-5-urdf-robot-description"},"next":{"title":"Module 3 Overview","permalink":"/Master-Robotics-AI/textbook/module-3/"}}');var a=r(4848),i=r(8453);const o={id:"chapter-6-integration-patterns",title:"Chapter 6: Integration Patterns",sidebar_label:"6. Integration Patterns",sidebar_position:7},s="Chapter 6: Integration Patterns and Python Agents",l={},c=[{value:"Chapter Goal",id:"chapter-goal",level:2},{value:"Learning Objectives",id:"learning-objectives",level:2},{value:"From Patterns to Systems",id:"from-patterns-to-systems",level:2},{value:"Multi-Pattern Node Architecture",id:"architecture",level:2},{value:"Example: Pick-and-Place Behavior",id:"example-pick-and-place-behavior",level:3},{value:"Pattern Selection Summary",id:"pattern-selection-summary",level:3},{value:"Integrated Behavior Node",id:"behavior-node",level:2},{value:"Callback Groups and Executors",id:"executors",level:2},{value:"The Problem",id:"the-problem",level:3},{value:"Callback Groups",id:"callback-groups",level:3},{value:"Executors",id:"executors",level:3},{value:"Launch Files",id:"launch-files",level:2},{value:"Basic Launch File",id:"basic-launch-file",level:3},{value:"Parameters",id:"parameters",level:3},{value:"Remappings",id:"remappings",level:3},{value:"Lifecycle Patterns",id:"lifecycle",level:2},{value:"Initialization Pattern",id:"initialization-pattern",level:3},{value:"Shutdown Pattern",id:"shutdown-pattern",level:3},{value:"Timing Analysis",id:"timing-analysis",level:2},{value:"Measuring Callback Latency",id:"measuring-callback-latency",level:3},{value:"End-to-End Latency",id:"end-to-end-latency",level:3},{value:"Summary",id:"summary",level:2},{value:"Module 2 Complete",id:"module-2-complete",level:2},{value:"What&#39;s Next",id:"whats-next",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"chapter-6-integration-patterns-and-python-agents",children:"Chapter 6: Integration Patterns and Python Agents"})}),"\n",(0,a.jsx)(n.h2,{id:"chapter-goal",children:"Chapter Goal"}),"\n",(0,a.jsxs)(n.p,{children:["By the end of this chapter, you will be able to ",(0,a.jsx)(n.strong,{children:"synthesize all ROS 2 communication patterns into coherent Python agents"})," that implement complete perception-action loops using topics, services, and actions together."]}),"\n",(0,a.jsx)(n.h2,{id:"learning-objectives",children:"Learning Objectives"}),"\n",(0,a.jsx)(n.p,{children:"After completing this chapter, you will be able to:"}),"\n",(0,a.jsxs)(n.table,{children:[(0,a.jsx)(n.thead,{children:(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.th,{children:"ID"}),(0,a.jsx)(n.th,{children:"Objective"})]})}),(0,a.jsxs)(n.tbody,{children:[(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"6.1"}),(0,a.jsx)(n.td,{children:"Design a node architecture that uses topics, services, and actions appropriately"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"6.2"}),(0,a.jsx)(n.td,{children:"Implement a behavior node that coordinates multiple communication patterns"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"6.3"}),(0,a.jsx)(n.td,{children:"Handle concurrent operations with proper callback management"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"6.4"}),(0,a.jsx)(n.td,{children:"Implement lifecycle patterns for robust node initialization and shutdown"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"6.5"}),(0,a.jsx)(n.td,{children:"Create launch files that configure and start multi-node systems"})]})]})]}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"from-patterns-to-systems",children:"From Patterns to Systems"}),"\n",(0,a.jsx)(n.p,{children:"You've learned three communication patterns:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Topics"}),": Continuous data streams (sensors, commands)"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Services"}),": Discrete operations (configuration, queries)"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Actions"}),": Long-running tasks (navigation, manipulation)"]}),"\n"]}),"\n",(0,a.jsxs)(n.p,{children:["Real robots use ",(0,a.jsx)(n.strong,{children:"all three together"}),". This chapter shows how to combine them."]}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"architecture",children:"Multi-Pattern Node Architecture"}),"\n",(0,a.jsx)(n.h3,{id:"example-pick-and-place-behavior",children:"Example: Pick-and-Place Behavior"}),"\n",(0,a.jsx)(n.p,{children:"A pick-and-place operation uses all patterns:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\r\n\u2502                     PickAndPlaceNode                              \u2502\r\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\r\n\u2502  SUBSCRIPTIONS (Topics)                                          \u2502\r\n\u2502    /camera/image        \u2192 Object detection input                 \u2502\r\n\u2502    /joint_states        \u2192 Current arm position                   \u2502\r\n\u2502    /gripper/state       \u2192 Gripper status                         \u2502\r\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\r\n\u2502  PUBLISHERS (Topics)                                             \u2502\r\n\u2502    /cmd_vel             \u2192 Base motion commands                   \u2502\r\n\u2502    /visualization       \u2192 Debug visualization                    \u2502\r\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\r\n\u2502  SERVICE CLIENTS                                                 \u2502\r\n\u2502    /gripper/command     \u2192 Open/close gripper                     \u2502\r\n\u2502    /arm/set_speed       \u2192 Configure arm speed                    \u2502\r\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\r\n\u2502  ACTION CLIENTS                                                  \u2502\r\n\u2502    /navigate_to_pose    \u2192 Move base to location                  \u2502\r\n\u2502    /move_arm            \u2192 Execute arm trajectory                 \u2502\r\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,a.jsx)(n.h3,{id:"pattern-selection-summary",children:"Pattern Selection Summary"}),"\n",(0,a.jsxs)(n.table,{children:[(0,a.jsx)(n.thead,{children:(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.th,{children:"Need"}),(0,a.jsx)(n.th,{children:"Pattern"}),(0,a.jsx)(n.th,{children:"Example"})]})}),(0,a.jsxs)(n.tbody,{children:[(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"Monitor sensor continuously"}),(0,a.jsx)(n.td,{children:"Topic subscription"}),(0,a.jsx)(n.td,{children:"Camera images"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"Send continuous commands"}),(0,a.jsx)(n.td,{children:"Topic publishing"}),(0,a.jsx)(n.td,{children:"Velocity commands"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"Configure before operation"}),(0,a.jsx)(n.td,{children:"Service call"}),(0,a.jsx)(n.td,{children:"Set arm speed"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"Execute discrete action"}),(0,a.jsx)(n.td,{children:"Service call"}),(0,a.jsx)(n.td,{children:"Open gripper"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"Execute long operation"}),(0,a.jsx)(n.td,{children:"Action call"}),(0,a.jsx)(n.td,{children:"Navigate to target"})]})]})]}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"behavior-node",children:"Integrated Behavior Node"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:"#!/usr/bin/env python3\r\n\"\"\"\r\nPick and Place Behavior Node\r\n\r\nIntegrates topics, services, and actions for pick-and-place.\r\n\"\"\"\r\n\r\nimport rclpy\r\nfrom rclpy.node import Node\r\nfrom rclpy.action import ActionClient\r\nfrom rclpy.callback_groups import ReentrantCallbackGroup, MutuallyExclusiveCallbackGroup\r\nfrom rclpy.executors import MultiThreadedExecutor\r\n\r\nfrom sensor_msgs.msg import Image, JointState\r\nfrom std_srvs.srv import SetBool\r\nfrom geometry_msgs.msg import PoseStamped\r\nfrom example_interfaces.action import Fibonacci  # Placeholder\r\n\r\nimport asyncio\r\n\r\n\r\nclass PickAndPlaceNode(Node):\r\n    \"\"\"Coordinates pick-and-place using multiple ROS 2 patterns.\"\"\"\r\n\r\n    def __init__(self):\r\n        super().__init__('pick_and_place')\r\n\r\n        # Callback groups for concurrent execution\r\n        self.sensor_cb_group = MutuallyExclusiveCallbackGroup()\r\n        self.action_cb_group = ReentrantCallbackGroup()\r\n\r\n        # State\r\n        self.current_joint_state = None\r\n        self.detected_object_pose = None\r\n        self.gripper_closed = False\r\n\r\n        # === SUBSCRIPTIONS ===\r\n        self.joint_sub = self.create_subscription(\r\n            JointState,\r\n            'joint_states',\r\n            self.joint_state_callback,\r\n            10,\r\n            callback_group=self.sensor_cb_group\r\n        )\r\n\r\n        self.image_sub = self.create_subscription(\r\n            Image,\r\n            'camera/image',\r\n            self.image_callback,\r\n            10,\r\n            callback_group=self.sensor_cb_group\r\n        )\r\n\r\n        # === SERVICE CLIENTS ===\r\n        self.gripper_client = self.create_client(\r\n            SetBool,\r\n            'gripper/command'\r\n        )\r\n\r\n        # === ACTION CLIENTS ===\r\n        self.navigate_client = ActionClient(\r\n            self,\r\n            Fibonacci,  # Placeholder for NavigateToPose\r\n            'navigate_to_pose',\r\n            callback_group=self.action_cb_group\r\n        )\r\n\r\n        self.move_arm_client = ActionClient(\r\n            self,\r\n            Fibonacci,  # Placeholder for MoveArm\r\n            'move_arm',\r\n            callback_group=self.action_cb_group\r\n        )\r\n\r\n        self.get_logger().info('Pick and place node initialized')\r\n\r\n    # === TOPIC CALLBACKS ===\r\n\r\n    def joint_state_callback(self, msg: JointState):\r\n        \"\"\"Process joint state updates.\"\"\"\r\n        self.current_joint_state = msg\r\n\r\n    def image_callback(self, msg: Image):\r\n        \"\"\"Process camera images for object detection.\"\"\"\r\n        # In real system: run detection, update self.detected_object_pose\r\n        pass\r\n\r\n    # === SERVICE CALLS ===\r\n\r\n    async def control_gripper(self, close: bool) -> bool:\r\n        \"\"\"Open or close gripper.\"\"\"\r\n        if not self.gripper_client.service_is_ready():\r\n            self.get_logger().error('Gripper service not available')\r\n            return False\r\n\r\n        request = SetBool.Request()\r\n        request.data = close\r\n\r\n        future = self.gripper_client.call_async(request)\r\n        result = await future\r\n\r\n        if result.success:\r\n            self.gripper_closed = close\r\n            self.get_logger().info(f'Gripper {\"closed\" if close else \"opened\"}')\r\n        else:\r\n            self.get_logger().error(f'Gripper command failed: {result.message}')\r\n\r\n        return result.success\r\n\r\n    # === ACTION CALLS ===\r\n\r\n    async def navigate_to(self, x: float, y: float) -> bool:\r\n        \"\"\"Navigate to position.\"\"\"\r\n        if not self.navigate_client.wait_for_server(timeout_sec=5.0):\r\n            self.get_logger().error('Navigation server not available')\r\n            return False\r\n\r\n        goal = Fibonacci.Goal()\r\n        goal.order = int(x * 100)  # Placeholder encoding\r\n\r\n        self.get_logger().info(f'Navigating to ({x}, {y})')\r\n\r\n        goal_handle = await self.navigate_client.send_goal_async(goal)\r\n\r\n        if not goal_handle.accepted:\r\n            self.get_logger().error('Navigation goal rejected')\r\n            return False\r\n\r\n        result = await goal_handle.get_result_async()\r\n        return result.status == 4  # SUCCEEDED\r\n\r\n    async def move_arm_to(self, pose: PoseStamped) -> bool:\r\n        \"\"\"Move arm to pose.\"\"\"\r\n        if not self.move_arm_client.wait_for_server(timeout_sec=5.0):\r\n            self.get_logger().error('Arm server not available')\r\n            return False\r\n\r\n        goal = Fibonacci.Goal()\r\n        goal.order = 10  # Placeholder\r\n\r\n        goal_handle = await self.move_arm_client.send_goal_async(goal)\r\n\r\n        if not goal_handle.accepted:\r\n            return False\r\n\r\n        result = await goal_handle.get_result_async()\r\n        return result.status == 4\r\n\r\n    # === HIGH-LEVEL BEHAVIOR ===\r\n\r\n    async def execute_pick_and_place(\r\n        self,\r\n        pick_location: tuple,\r\n        place_location: tuple\r\n    ) -> bool:\r\n        \"\"\"\r\n        Execute complete pick and place sequence.\r\n\r\n        This demonstrates how to coordinate multiple patterns:\r\n        1. Navigate to pick location (action)\r\n        2. Detect object (topic data)\r\n        3. Move arm to object (action)\r\n        4. Close gripper (service)\r\n        5. Move arm up (action)\r\n        6. Navigate to place location (action)\r\n        7. Move arm down (action)\r\n        8. Open gripper (service)\r\n        9. Move arm to home (action)\r\n        \"\"\"\r\n        self.get_logger().info('Starting pick and place sequence')\r\n\r\n        # 1. Navigate to pick location\r\n        self.get_logger().info('Step 1: Navigate to pick location')\r\n        if not await self.navigate_to(*pick_location):\r\n            self.get_logger().error('Failed to navigate to pick location')\r\n            return False\r\n\r\n        # 2. Wait for object detection (from topic callback)\r\n        self.get_logger().info('Step 2: Waiting for object detection')\r\n        # In real system: wait until self.detected_object_pose is valid\r\n\r\n        # 3. Move arm to object\r\n        self.get_logger().info('Step 3: Moving arm to object')\r\n        object_pose = PoseStamped()  # Would come from detection\r\n        if not await self.move_arm_to(object_pose):\r\n            self.get_logger().error('Failed to move arm to object')\r\n            return False\r\n\r\n        # 4. Close gripper\r\n        self.get_logger().info('Step 4: Closing gripper')\r\n        if not await self.control_gripper(close=True):\r\n            self.get_logger().error('Failed to close gripper')\r\n            return False\r\n\r\n        # 5. Move arm up (retract)\r\n        self.get_logger().info('Step 5: Retracting arm')\r\n        # ... similar action call\r\n\r\n        # 6. Navigate to place location\r\n        self.get_logger().info('Step 6: Navigate to place location')\r\n        if not await self.navigate_to(*place_location):\r\n            # Error handling: we have object, need safe behavior\r\n            self.get_logger().error('Navigation failed while holding object')\r\n            return False\r\n\r\n        # 7. Move arm down\r\n        self.get_logger().info('Step 7: Moving arm to place position')\r\n        # ... similar action call\r\n\r\n        # 8. Open gripper\r\n        self.get_logger().info('Step 8: Opening gripper')\r\n        if not await self.control_gripper(close=False):\r\n            self.get_logger().error('Failed to open gripper')\r\n            return False\r\n\r\n        # 9. Move arm to home\r\n        self.get_logger().info('Step 9: Moving arm to home')\r\n        # ... similar action call\r\n\r\n        self.get_logger().info('Pick and place complete!')\r\n        return True\r\n\r\n\r\nasync def main_async():\r\n    rclpy.init()\r\n    node = PickAndPlaceNode()\r\n\r\n    # Use multi-threaded executor for concurrent callbacks\r\n    executor = MultiThreadedExecutor()\r\n    executor.add_node(node)\r\n\r\n    # Run executor in background\r\n    executor_task = asyncio.get_event_loop().run_in_executor(\r\n        None, executor.spin\r\n    )\r\n\r\n    # Execute behavior\r\n    try:\r\n        success = await node.execute_pick_and_place(\r\n            pick_location=(1.0, 0.5),\r\n            place_location=(2.0, 0.5)\r\n        )\r\n        print(f'Pick and place result: {success}')\r\n    finally:\r\n        executor.shutdown()\r\n        node.destroy_node()\r\n        rclpy.shutdown()\r\n\r\n\r\ndef main():\r\n    asyncio.run(main_async())\r\n\r\n\r\nif __name__ == '__main__':\r\n    main()\n"})}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"executors",children:"Callback Groups and Executors"}),"\n",(0,a.jsx)(n.h3,{id:"the-problem",children:"The Problem"}),"\n",(0,a.jsx)(n.p,{children:"By default, callbacks execute sequentially. If a service call blocks for 2 seconds, no topic callbacks run during that time."}),"\n",(0,a.jsx)(n.h3,{id:"callback-groups",children:"Callback Groups"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:"from rclpy.callback_groups import (\r\n    MutuallyExclusiveCallbackGroup,\r\n    ReentrantCallbackGroup\r\n)\r\n\r\n# Mutually exclusive: only one callback at a time\r\nsensor_group = MutuallyExclusiveCallbackGroup()\r\n\r\n# Reentrant: callbacks can run concurrently\r\naction_group = ReentrantCallbackGroup()\r\n\r\n# Assign to subscriptions/clients\r\nself.create_subscription(..., callback_group=sensor_group)\r\nself.create_service(..., callback_group=action_group)\n"})}),"\n",(0,a.jsx)(n.h3,{id:"executors",children:"Executors"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:"from rclpy.executors import (\r\n    SingleThreadedExecutor,  # Default, sequential\r\n    MultiThreadedExecutor    # Concurrent execution\r\n)\r\n\r\n# For concurrent operation, use multi-threaded\r\nexecutor = MultiThreadedExecutor()\r\nexecutor.add_node(node)\r\nexecutor.spin()\n"})}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Physical Grounding"}),": If sensor callbacks must run at 100 Hz (10 ms) but action execution takes 5 seconds, you ",(0,a.jsx)(n.strong,{children:"must"})," use concurrent execution. Otherwise, you violate M1 timing requirements."]}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"launch-files",children:"Launch Files"}),"\n",(0,a.jsx)(n.p,{children:"Launch files start and configure multiple nodes."}),"\n",(0,a.jsx)(n.h3,{id:"basic-launch-file",children:"Basic Launch File"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:"# launch/pick_and_place.launch.py\r\nfrom launch import LaunchDescription\r\nfrom launch_ros.actions import Node\r\n\r\n\r\ndef generate_launch_description():\r\n    return LaunchDescription([\r\n        # Robot state publisher\r\n        Node(\r\n            package='robot_state_publisher',\r\n            executable='robot_state_publisher',\r\n            parameters=[{'robot_description': '...'}]\r\n        ),\r\n\r\n        # Pick and place behavior\r\n        Node(\r\n            package='my_robot',\r\n            executable='pick_and_place_node',\r\n            name='pick_and_place',\r\n            parameters=[\r\n                {'max_velocity': 0.5},\r\n                {'gripper_timeout': 5.0}\r\n            ],\r\n            remappings=[\r\n                ('camera/image', '/front_camera/image_raw'),\r\n                ('joint_states', '/arm/joint_states')\r\n            ]\r\n        ),\r\n\r\n        # Gripper controller\r\n        Node(\r\n            package='my_robot',\r\n            executable='gripper_service',\r\n            name='gripper_controller'\r\n        ),\r\n\r\n        # Navigation action server\r\n        Node(\r\n            package='nav2_bt_navigator',\r\n            executable='bt_navigator',\r\n            name='navigator'\r\n        ),\r\n    ])\n"})}),"\n",(0,a.jsx)(n.h3,{id:"parameters",children:"Parameters"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:"# In node\r\nself.declare_parameter('max_velocity', 0.5)\r\nmax_vel = self.get_parameter('max_velocity').value\r\n\r\n# In launch file\r\nparameters=[{'max_velocity': 1.0}]\r\n\r\n# From command line\r\nros2 run my_robot my_node --ros-args -p max_velocity:=1.0\n"})}),"\n",(0,a.jsx)(n.h3,{id:"remappings",children:"Remappings"}),"\n",(0,a.jsx)(n.p,{children:"Connect nodes with different topic names:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:"remappings=[\r\n    ('input_topic', '/actual_topic_name'),\r\n    ('output_topic', '/different_name')\r\n]\n"})}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"lifecycle",children:"Lifecycle Patterns"}),"\n",(0,a.jsx)(n.p,{children:"Robust nodes handle startup and shutdown gracefully."}),"\n",(0,a.jsx)(n.h3,{id:"initialization-pattern",children:"Initialization Pattern"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:'class RobustNode(Node):\r\n    def __init__(self):\r\n        super().__init__(\'robust_node\')\r\n\r\n        self.initialized = False\r\n\r\n        # Create interfaces\r\n        self.setup_interfaces()\r\n\r\n        # Wait for dependencies\r\n        self.create_timer(1.0, self.check_initialization)\r\n\r\n    def setup_interfaces(self):\r\n        """Create all ROS interfaces."""\r\n        self.sensor_sub = self.create_subscription(...)\r\n        self.gripper_client = self.create_client(...)\r\n\r\n    def check_initialization(self):\r\n        """Check if all dependencies are ready."""\r\n        if self.initialized:\r\n            return\r\n\r\n        # Check service availability\r\n        if not self.gripper_client.service_is_ready():\r\n            self.get_logger().info(\'Waiting for gripper service...\')\r\n            return\r\n\r\n        # Check for sensor data\r\n        if self.last_sensor_msg is None:\r\n            self.get_logger().info(\'Waiting for sensor data...\')\r\n            return\r\n\r\n        # All ready\r\n        self.initialized = True\r\n        self.get_logger().info(\'Node fully initialized\')\n'})}),"\n",(0,a.jsx)(n.h3,{id:"shutdown-pattern",children:"Shutdown Pattern"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:'def shutdown(self):\r\n    """Graceful shutdown."""\r\n    self.get_logger().info(\'Shutting down...\')\r\n\r\n    # Cancel any active goals\r\n    if self.active_goal_handle:\r\n        self.active_goal_handle.cancel_goal_async()\r\n\r\n    # Safe state (e.g., stop motion)\r\n    self.publish_zero_velocity()\r\n\r\n    # Open gripper if holding object\r\n    if self.gripper_closed:\r\n        self.control_gripper(close=False)\r\n\r\n    self.get_logger().info(\'Shutdown complete\')\n'})}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"timing-analysis",children:"Timing Analysis"}),"\n",(0,a.jsx)(n.p,{children:"Verify your system meets M1 physical constraints."}),"\n",(0,a.jsx)(n.h3,{id:"measuring-callback-latency",children:"Measuring Callback Latency"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:"import time\r\n\r\ndef image_callback(self, msg):\r\n    start = time.time()\r\n\r\n    # Processing...\r\n    self.process_image(msg)\r\n\r\n    elapsed = time.time() - start\r\n    if elapsed > 0.030:  # 30ms budget\r\n        self.get_logger().warn(f'Image callback took {elapsed*1000:.1f}ms')\n"})}),"\n",(0,a.jsx)(n.h3,{id:"end-to-end-latency",children:"End-to-End Latency"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:"def image_callback(self, msg):\r\n    # Message timestamp\r\n    msg_time = msg.header.stamp.sec + msg.header.stamp.nanosec * 1e-9\r\n\r\n    # Current time\r\n    now = self.get_clock().now().nanoseconds * 1e-9\r\n\r\n    # Transport latency\r\n    transport_latency = now - msg_time\r\n\r\n    if transport_latency > 0.050:  # 50ms threshold\r\n        self.get_logger().warn(\r\n            f'High transport latency: {transport_latency*1000:.1f}ms'\r\n        )\n"})}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,a.jsx)(n.p,{children:"This chapter synthesized all ROS 2 patterns:"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Multi-pattern nodes"})," combine topics, services, and actions for complex behaviors."]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Callback groups and executors"})," enable concurrent operation\u2014essential when actions block but sensors must still be processed."]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Launch files"})," configure and start multi-node systems with parameters and remappings."]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Lifecycle patterns"})," ensure robust initialization and graceful shutdown."]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Timing analysis"})," verifies that your implementation meets M1 physical constraints."]}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"module-2-complete",children:"Module 2 Complete"}),"\n",(0,a.jsx)(n.p,{children:"Congratulations on completing Module 2: ROS 2 Fundamentals!"}),"\n",(0,a.jsx)(n.p,{children:"You can now:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Implement robotic communication using topics, services, and actions"}),"\n",(0,a.jsx)(n.li,{children:"Configure QoS based on physical sensor/actuator requirements"}),"\n",(0,a.jsx)(n.li,{children:"Describe robots using URDF"}),"\n",(0,a.jsx)(n.li,{children:"Build integrated Python agents that implement perception-action loops"}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"whats-next",children:"What's Next"}),"\n",(0,a.jsxs)(n.p,{children:["In ",(0,a.jsx)(n.a,{href:"/module-3",children:"Module 3: Simulation and Digital Twin"}),", you'll connect these ROS 2 nodes to physics-simulated robots in Gazebo. The code you wrote in this module will work unchanged\u2014only the source of sensor data changes from simulated sensors."]})]})}function p(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}},8453(e,n,r){r.d(n,{R:()=>o,x:()=>s});var t=r(6540);const a={},i=t.createContext(a);function o(e){const n=t.useContext(i);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:o(e.components),t.createElement(i.Provider,{value:n},e.children)}}}]);